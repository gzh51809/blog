# 4 字符串的拓展

## 字符串的Unicode表示法

JavaScript 允许采用`\uxxxx`形式表示一个字符，其中xxxx表示字符的 Unicode 码点。


## codePointAt() - 共有方法

`JavaScript`内部，字符以`UTF-16`的格式储存，每个字符固定为2个字节。对于那些需要4个字节储存的字符（Unicode码点大于`0xFFFF`的字符），JavaScript会认为它们是两个字符。

`codePointAt`方法会正确返回32位的UTF-16字符的码点。

`codePointAt`方法是测试一个字符由两个字节还是由四个字节组成的最简单方法。

!> 使用for...of循环 也可以，因为它会正确识别32位的UTF-16字符。

## String.fromCodePoint() - 静态方法

用于从码点返回对应字符，但是这个方法不能识别32位的UTF-16字符（Unicode编号大于`0xFFFF`）。

## 字符串的遍历器接口

ES6为字符串添加了遍历器接口（详见《Iterator》一章），使得字符串可以被for...of循环遍历。

```js
for (let codePoint of 'foo') {
  console.log(codePoint)
}
// "f"
// "o"
// "o"
```
除了遍历字符串，这个遍历器最大的优点是可以识别大于0xFFFF的码点，传统的for循环无法识别这样的码点。

## at()

ES5对字符串对象提供`charAt`方法，返回字符串给定位置的字符。该方法不能识别码点大于0xFFFF的字符。

目前，有一个提案，提出字符串实例的at方法，可以识别Unicode编号大于0xFFFF的字符，返回正确的字符。

## normalize() 

ES6提供字符串实例的normalize()方法，用来将字符的不同表示方法统一为同样的形式，这称为Unicode正规化。

## includes(), startsWith(), endsWith()

- includes()：返回布尔值，表示是否找到了参数字符串。
- startsWith()：返回布尔值，表示参数字符串是否在源字符串的头部。
- endsWith()：返回布尔值，表示参数字符串是否在源字符串的尾部。

## repeat()

repeat方法返回一个新字符串，表示将原字符串重复n次。

```js
'x'.repeat(3) // "xxx"
'hello'.repeat(2) // "hellohello"
'na'.repeat(0) // ""
```

## padStart()，padEnd()

ES2017 引入了字符串补全长度的功能。如果某个字符串不够指定长度，会在头部或尾部补全。padStart()用于头部补全，padEnd()用于尾部补全。
```js
'x'.padStart(5, 'ab') // 'ababx'
'x'.padStart(4, 'ab') // 'abab'
```
padStart的常见用途是为数值补全指定位数。下面代码生成10位的数值字符串。
```js
'1'.padStart(10, '0') // "0000000001"
'12'.padStart(10, '0') // "0000000012"
'123456'.padStart(10, '0') // "0000123456"
```
另一个用途是提示字符串格式。
```js
'12'.padStart(10, 'YYYY-MM-DD') // "YYYY-MM-12"
'09-12'.padStart(10, 'YYYY-MM-DD') // "YYYY-09-12"
```

## 模板字符串
```js
let str = 'World';
let info = `Hello, ${str}`;
// 大括号内部可以放入任意的JavaScript表达式，可以进行运算，以及引用对象属性。
```

## 模板字符串的嵌套

```js
const data = [
    { first: '<Jane>', last: 'Bond' },
    { first: 'Lars', last: '<Croft>' },
];

const tmpl = addrs => `
  <table>
  ${addrs.map(addr => `
    <tr><td>${addr.first}</td></tr>
    <tr><td>${addr.last}</td></tr>
  `).join('')}
  </table>
`;

// 为什么有种JSX的既视感......
```

## 实例：模板编译

## 标签模板

模板字符串的功能，不仅仅是上面这些。它可以紧跟在一个函数名后面，该函数将被调用来处理这个模板字符串。这被称为“标签模板”功能（tagged template）。

```js
alert`123`
// 等同于
alert(123)
```

除此之外，你甚至可以使用标签模板，在JavaScript语言之中嵌入其他语言。(略过)

## String.raw()

```js
String.raw`Hi\n${2+3}!`;
// "Hi\\n5!"

String.raw`Hi\u000A!`;
// 'Hi\\u000A!'
```
