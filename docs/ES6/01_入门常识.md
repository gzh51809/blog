# ECMAScript 6 入门常识

!> 注：本文总结自`ruanyf`老师的`ECMAScript 6 入门`，请支持原作者。

## ES和JS的关系

ECMAScript 和 JavaScript 的关系是，ES是JS的规格，JS是ES的一种实现，因为ES还有方言。

## ES6 与 ECMAScript 2015 的关系

ES6 既是一个历史名词，也是一个泛指，含义是5.1版以后的 JavaScript 的下一代标准，涵盖了ES2015、ES2016、ES2017等等，而ES2015 则是正式名称。

## 语法提案的批准流程

任何人都可以向标准委员会（又称 TC39 委员会）提案，要求修改语言标准。
一种新的语法从提案到变成正式标准，需要经历五个阶段。

## ECMAScript 的历史

- 1997, ECMAScript 1.0 发布
- 1998, ECMAScript 2.0 发布
- 1999, ECMAScript 3.0 发布 —— 巨大成功
- 2000, 开始酝酿 ES4
- 2007, 发布 ES4 草案, 但是由于太激进，对ES3做了彻底升级，各方分歧导致ES4流产
- 2008, ES4 终止开发。将 ES4 其中一小部分特性纳入标准改名为 ES3.1 , 此后，ES3.1改名为ES5
- 2009, ECMAScript 5.0 发布
- 2011, ECMAScript 5.1 发布 - 并且成为 ISO 国际标准
- 2015，ECMAScript 6 正式通过，成为国际标准。

## 部署进度

- 在线查询：[http://kangax.github.io/compat-table/es6/](http://kangax.github.io/compat-table/es6/)

- 查询本地浏览器对ES6的兼容性：https://github.com/ruanyf/es-checker

```markdown
$ npm install -g es-checker
$ es-checker
```

- 截止今天，Chrome 57 + ,Opera 44 + 是百分百支持ES6的特性的。
 
- Node 是 JavaScript 的服务器运行环境（runtime）。它对 ES6 的支持更高。除了那些默认打开的功能，还有一些语法功能已经实现了，但是默认没有打开。

## Babel 转码器 
- 作用；将 ES6 代码转为 ES5
- 例子：
```js
// 转码前
input.map(item => item + 1);

// 转码后
input.map(function (item) {
  return item + 1;
});
```

### 配置文件 `.babelre`

基本格式：

```json
{
  "presets": [],
  "plugins": []
}
```
presets字段设定转码规则，官方提供以下的规则集，你可以根据需要安装。

```
# 最新转码规则
$ npm install --save-dev babel-preset-latest

# react 转码规则
$ npm install --save-dev babel-preset-react

# 不同阶段语法提案的转码规则（共有4个阶段），选装一个
$ npm install --save-dev babel-preset-stage-0
$ npm install --save-dev babel-preset-stage-1
$ npm install --save-dev babel-preset-stage-2
$ npm install --save-dev babel-preset-stage-3
```

例子：
```json
  {
    "presets": [
      "latest",
      "react",
      "stage-2"
    ],
    "plugins": []
  }
```

### 命令行转码 `babel-cli`

```
$ npm install --global babel-cli
```
基本使用:

```
$ babel example.js -o compiled.js
```

参数|说明
---|---
-o / -out|指定输出
-d / -dir|指定输出目录
-a | 生成source map文件

babel-cli安装在项目之中, 以避免对全局环境的依赖。

```
$ npm install --save-dev babel-cli
```

### babel-node
 
支持Node的REPL环境的所有功能，而且可以直接运行ES6代码。 

### bebal-register

babel-register模块改写require命令，为它加上一个钩子。此后，每当使用require加载.js、.jsx、.es和.es6后缀名的文件，就会先用Babel进行转码。

```markdown
npm install --save-dev babel-register
```

使用时，必须首先加载babel-register。
```js
require("babel-register");
require("./index.js");
```

### babel-core

如果某些代码需要调用 Babel 的 API 进行转码，就要使用babel-core模块。
 

### babel-polyfill

Babel 默认只转换新的 JavaScript 句法（syntax），而不转换新的 API，比如`Iterator、Generator、Set、Maps、Proxy、Reflect、Symbol、Promise`等全局对象，以及一些定义在全局对象上的方法（比如`Object.assign`）都不会转码。

举例来说，ES6在Array对象上新增了`Array.from`方法。Babel 就不会转码这个方法。如果想让这个方法运行，必须使用`babel-polyfill`，为当前环境提供一个垫片。

安装命令如下。
```markdown
$ npm install --save babel-polyfill
```
然后，在脚本头部，加入如下一行代码。
```markdown
import 'babel-polyfill';
```
// 或者
```markdown
require('babel-polyfill');
```
Babel 默认不转码的 API 非常多，详细清单可以查看babel-plugin-transform-runtime模块的[definitions.js ](https://github.com/babel/babel/blob/master/packages/babel-plugin-transform-runtime/src/definitions.js)文件。


### 浏览器环境

从 Babel 6.0 开始，不再直接提供浏览器版本。

```js
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.4.4/babel.min.js"></script>
<script type="text/babel">
// Your ES6 code
</script>
```

注意，网页实时将 ES6 代码转为 ES5，对性能会有影响。生产环境需要加载已经转码完成的脚本。

下面是如何将代码打包成浏览器可以使用的脚本，以Babel配合Browserify为例。首先，安装babelify模块。
```
$ npm install --save-dev babelify babel-preset-latest
```

然后，再用命令行转换 ES6 脚本。
```markdown
$  browserify script.js -o bundle.js \
  -t [ babelify --presets [ latest ] ]
```
上面代码将ES6脚本script.js，转为bundle.js，浏览器直接加载后者就可以了。

在package.json设置下面的代码，就不用每次命令行都输入参数了。

```
{
  "browserify": {
    "transform": [["babelify", { "presets": ["latest"] }]]
  }
}
```

### 浏览器环境
Babel 提供一个 [REPL在线编译器](https://babeljs.io/repl/)，可以在线将 ES6 代码转为 ES5 代码。转换后的代码，可以直接作为 ES5 代码插入网页运行。

### 与其他工具的配合 

与其他工具的配合
许多工具需要 Babel

