# 深入浅出观察者模式

## 引子

在此之前，观察者模式`(Observer)`于我一直都是一个已经比较抽象而又强大的模式。虽然从字面上理解，观察者，无非就是用来观察变化的一个对象。但是，如何观察，又如何通知变化呢？观察者、订阅者、被观察者、被订阅者这些名词之间究竟有何联系。接下来，结合观察者模式的别名——发布/订阅模式，和生活的一些例子，来聊聊观察者模式的思想。

我们都用过`Weibo`, 一个朋友圈的形成，得益于`Weibo`的关注功能。如果你关注了`@尤雨溪`，那么，尤老师每一条更新的微博，都将会在出现在你的微博列表里。在这个关系中，尤老师和他的关注者是`One to many`的关系。实际上，这就是观察者模式的基本思想——适用于多个对象依赖于同一个对象状态变化的场景。


## 场景

当你同时向阿里、华为和谷歌发送了应聘邮件，此时如果招聘方将根据你的能力来决定是否给你回信，请用js代码模拟这个业务场景。

首先，我们写一个`Company`类, 类中有一个属性`candidates`，是面试者的集合。
```js
	// 公司
	function Company(name) {
		this.name = name;
		// 应聘者的集合
		this.candidates = new Array();
	}
```
`Company`类还拥有一个共有方法`sendEmail()`，用于向应聘者发送应聘结果的邮件:
```js
	Company.prototype.sendEmail = function () {
		this.candidates.forEach(function (candidate) {
			// 面试结果
			// 面试者的能力考核大于90分则通过
			var _status = candidate.ability > 90 ? 'Pass' : 'Refuse'
			candidate.getEmail(this.name, _status)

		}.bind(this))
	}
```
接下来，我们构造应聘者者类: 
```js
	// 应聘者
	function Candidate(name, ability) {
		this.name = name;
		this.ability = ability;
	}
```
应聘者还应该有一个接受邮件的共有方法：

```js
	Candidate.prototype.getEmail = function (msg, ststus) {
		console.info('(' + this.name + ') : The (' + msg + ') interview result is ' + ststus)
	}
```
接下来我们创建阿里、华为和谷歌这三家公司：

```js
	var Ali = new Company('Ali');
	var Huawei = new Company('Huawei');
	var Google = new Company('Google');

```
再创建两个程序员——

```js
	var aCoder = new Candidate('A', 95);
	var bCoder = new Candidate('B', 85);

	// 应聘
	Ali.candidates.push(aCoder, bCoder)
	Huawei.candidates.push(aCoder, bCoder)
	Google.candidates.push(aCoder, bCoder)

	// 发送面试通知
	Ali.sendEmail()
	Ali.sendEmail()
	Ali.sendEmail()
```
